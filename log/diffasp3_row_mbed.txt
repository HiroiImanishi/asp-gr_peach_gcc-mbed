diff --git a/./row_asp3/OBJ/Makefile b/./examples/truestudio/Makefile.asp
index 2a64ace..6aa1eda 100644
--- a/./row_asp3/OBJ/Makefile
+++ b/./examples/truestudio/Makefile.asp
@@ -53,31 +53,39 @@ TARGET = gr_peach_gcc
 #
 #  プログラミング言語の定義
 #
-SRCLANG = c
+SRCLANG = c++
 ifeq ($(SRCLANG),c)
 	LIBS = -lc
 endif
 ifeq ($(SRCLANG),c++)
-	USE_CXX = true
-	CXXLIBS = -lstdc++ -lm -lc
-	CXXRTS = cxxrt.o newlibrt.o
+   USE_CXX = true
+#  CXXLIBS = -lstdc++ -lm -lc
+#  CXXRTS = cxxrt.o newlibrt.o
 endif
 
 #
 #  ソースファイルのディレクトリの定義
 #
-SRCDIR = ..
+# SRCDIR = ..
 
 #
 #  オブジェクトファイル名の拡張子の設定
 #
+ifneq ($(USE_TRUESTUDIO),true)
 OBJEXT = 
+else
+OBJEXT = elf
+endif
 
 #
+#  DBGENVはasp3で廃止されている
+#  
+# DBGENV :=
+#
 #  カーネルライブラリ（libkernel.a）のディレクトリ名
 #  （カーネルライブラリもmake対象にする時は，空に定義する）
 #
-KERNEL_LIB = 
+# KERNEL_LIB = 
 
 #
 #  カーネルを関数単位でコンパイルするかどうかの定義
@@ -156,50 +164,52 @@ endif
 
 #
 #  共通コンパイルオプションの定義
-#
-COPTS := -g  $(COPTS)
+#  -I$(SRCDIR)archを追加(imanishi)
+COPTS := $(COPTS) -g -O0 -ggdb
 ifndef OMIT_WARNING_ALL
-	COPTS := -Wall $(COPTS)
+	COPTS := $(COPTS) -Wall
 endif
 ifndef OMIT_OPTIMIZATION
-	COPTS := -O2 $(COPTS)
+	COPTS := $(COPTS) -O2
 endif
 ifdef OMIT_TECS
 	CDEFS := -DTOPPERS_OMIT_TECS $(CDEFS)
 endif
 CDEFS := $(CDEFS) 
-INCLUDES := -I. -I$(SRCDIR)/include $(INCLUDES) -I$(SRCDIR)
+INCLUDES := -I. -I$(SRCDIR)/include -I$(SRCDIR)/arch $(INCLUDES) -I$(SRCDIR)
 LDFLAGS := $(LDFLAGS) 
+CFG1_OUT_LDFLAGS := $(CFG1_OUT_LDFLAGS)
 LIBS := $(LIBS) $(CXXLIBS)
 CFLAGS = $(COPTS) $(CDEFS) $(INCLUDES)
 
 #
 #  アプリケーションプログラムに関する定義
-#
-APPLNAME = sample1
-APPLDIRS = $(SRCDIR)/sample
-APPL_CFG = sample1.cfg
-APPL_CDL = sample1.cdl
-
-APPL_DIRS := $(APPLDIRS) $(SRCDIR)/library
-APPL_ASMOBJS :=
+#  include_pathsを追加
+# APPLNAME = sample1
+# APPLDIR = $(SRCDIR)/sample
+# APPL_CFG = sample1.cfg
+# APPL_CDL = sample1.cdl
+
+APPL_DIRS = $(APPLDIR) $(SRCDIR)/library
+APPL_ASMOBJS := $(APPL_ASMOBJS)
 ifdef USE_CXX
-	APPL_CXXOBJS := sample1.o
-	APPL_COBJS :=
+	APPL_CXXOBJS := $(APPLNAME).o $(APPL_CXXOBJS)
+	APPL_COBJS := $(APPL_COBJS)
 else
-	APPL_COBJS := sample1.o
+	APPL_COBJS := $(APPLNAME).o $(APPL_COBJS)
 endif
 APPL_COBJS := $(APPL_COBJS) log_output.o vasyslog.o t_perror.o strerror.o
-APPL_CFLAGS := $(APPL_CFLAGS)
-ifdef APPLDIRS
-	INCLUDES := $(INCLUDES) $(foreach dir,$(APPLDIRS),-I$(dir))
+# APPL_CFLAGS = 
+ifdef APPLDIR
+	INCLUDES := $(INCLUDES) $(foreach dir,$(APPLDIR),-I$(dir))
+	INCLUDE_PATHS := $(INCLUDE_PATHS)  $(foreach dir,$(APPLDIR),-I$(dir)) 
 endif
 
 #
 #  システムサービスに関する定義
-#
+#  $(SRCDIR)libraryを追加
 SYSSVC_DIRS := $(TECSGENDIR) $(SRCDIR)/tecs_kernel \
-				$(SYSSVC_DIRS) $(SRCDIR)/syssvc
+				$(SYSSVC_DIRS) $(SRCDIR)/syssvc $(SRCDIR)/library
 SYSSVC_ASMOBJS := $(SYSSVC_ASMOBJS)
 SYSSVC_COBJS := $(SYSSVC_COBJS)  $(TECS_COBJS) \
 				$(INIT_TECS_COBJ) $(CXXRTS)
@@ -281,6 +291,7 @@ endif
 #  ソースファイルのあるディレクトリに関する定義
 #
 vpath %.c $(KERNEL_DIRS) $(SYSSVC_DIRS) $(APPL_DIRS)
+vpath %.cpp $(KERNEL_DIRS) $(SYSSVC_DIRS) $(APPL_DIRS)
 vpath %.S $(KERNEL_DIRS) $(SYSSVC_DIRS) $(APPL_DIRS)
 vpath %.cfg $(APPL_DIRS)
 vpath %.cdl $(APPL_DIRS)
@@ -293,25 +304,19 @@ SYSSVC_OBJS = $(SYSSVC_ASMOBJS) $(SYSSVC_COBJS)
 APPL_OBJS = $(APPL_ASMOBJS) $(APPL_COBJS) $(APPL_CXXOBJS)
 ALL_OBJS = $(START_OBJS) $(APPL_OBJS) $(SYSSVC_OBJS) $(CFG_OBJS) \
 											$(END_OBJS) $(HIDDEN_OBJS)
-ALL_LIBS = -lkernel $(LIBS)
+# ALL_LIBS = -lkernel $(LIBS)
 ifdef KERNEL_LIB
-	LIBS_DEP = $(KERNEL_LIB)/libkernel.a $(filter %.a,$(LIBS))
-	OBJ_LDFLAGS := $(OBJ_LDFLAGS) -L$(KERNEL_LIB)
+	ALL_LIBS = $(APPL_LIBS) $(SYSSVC_LIBS) -lkernel $(LIBS)
+	LIBS_DEP = $(filter %.a,$(ALL_LIBS)) $(KERNEL_LIB)/libkernel.a 
+#	OBJ_LDFLAGS := $(OBJ_LDFLAGS) -L$(KERNEL_LIB)
+	LDFLAGS := $(LDFLAGS) -L$(KERNEL_LIB)
 	REALCLEAN_FILES := libkernel.a $(REALCLEAN_FILES)
 else
-	LIBS_DEP = libkernel.a $(filter %.a,$(LIBS))
-	OBJ_LDFLAGS := $(OBJ_LDFLAGS) -L.
+	ALL_LIBS = $(APPL_LIBS) $(SYSSVC_LIBS) libkernel.a $(LIBS)
+	LIBS_DEP = $(filter %.a,$(ALL_LIBS))
+#	OBJ_LDFLAGS := $(OBJ_LDFLAGS) -L.
 endif
 
-ifdef TEXT_START_ADDRESS
-	LDFLAGS := $(LDFLAGS) -Wl,-Ttext,$(TEXT_START_ADDRESS)
-endif
-ifdef DATA_START_ADDRESS
-	LDFLAGS := $(LDFLAGS) -Wl,-Tdata,$(DATA_START_ADDRESS)
-endif
-ifdef LDSCRIPT
-	LDFLAGS := $(LDFLAGS) -Wl,-T,$(LDSCRIPT)
-endif
 
 #
 #  tecsgenからCプリプロセッサを呼び出す際のオプションの定義
@@ -326,6 +331,19 @@ tecs $(TECSGEN_SRCS) $(TECS_HEADERS): $(TECSGEN_TIMESTAMP) ;
 $(TECSGEN_TIMESTAMP): $(APPL_CDL) $(TECS_IMPORTS)
 	$(TECSGEN) $< -R $(INCLUDES) --cpp "$(TECS_CPP)" -g $(TECSGENDIR)
 
+#check
+ifdef TEXT_START_ADDRESS
+  LDFLAGS := $(LDFLAGS) -Wl,-Ttext,$(TEXT_START_ADDRESS)
+  CFG1_OUT_LDFLAGS := $(CFG1_OUT_LDFLAGS) -Wl,-Ttext,$(TEXT_START_ADDRESS)
+endif
+ifdef DATA_START_ADDRESS
+  LDFLAGS := $(LDFLAGS) -Wl,-Tdata,$(DATA_START_ADDRESS)
+  CFG1_OUT_LDFLAGS := $(CFG1_OUT_LDFLAGS) -Wl,-Tdata,$(DATA_START_ADDRESS)
+endif
+ifdef LDSCRIPT
+  LDFLAGS := $(LDFLAGS) -T $(LDSCRIPT)
+  CFG1_OUT_LDFLAGS := $(CFG1_OUT_LDFLAGS) -T $(LDSCRIPT)
+endif
 #
 #  カーネルのコンフィギュレーションファイルの生成
 #
@@ -335,7 +353,7 @@ cfg1_out.timestamp: $(APPL_CFG) $(TECSGEN_TIMESTAMP)
 						-M $(DEPDIR)/cfg1_out_c.d $(TARGET_KERNEL_CFG) $<
 
 $(CFG1_OUT): $(START_OBJS) cfg1_out.o $(END_OBJS) $(HIDDEN_OBJS)
-	$(LINK) $(CFLAGS) $(LDFLAGS) $(CFG1_OUT_LDFLAGS) -o $(CFG1_OUT) \
+	$(LINK) $(CFLAGS) $(CFG1_OUT_LDFLAGS) -o $(CFG1_OUT) \
 						$(START_OBJS) cfg1_out.o $(LIBS) $(END_OBJS)
 
 cfg1_out.syms: $(CFG1_OUT)
@@ -410,6 +428,8 @@ check.timestamp: cfg2_out.db $(OBJNAME).syms $(OBJNAME).srec
 #
 .PHONY: clean
 clean:
+ifneq ($(USE_TRUESTUDIO),true)
+	rm -f $(LIB).a $(ALL_OBJ) $(DEPS)
 	rm -f \#* *~ *.o $(DEPDIR)/*.d $(CLEAN_FILES) check.timestamp
 	rm -f $(OBJFILE) $(OBJNAME).syms $(OBJNAME).srec $(OBJNAME).bin
 	rm -f kernel_cfg.timestamp $(CFG2_OUT_SRCS) cfg2_out.db
@@ -420,15 +440,51 @@ clean:
 ifndef KERNEL_LIB
 	rm -f libkernel.a
 endif
+	rm -f makeoffset.s offset.h
+else
+	-rm -f $(LIB).a $(ALL_OBJ) $(DEPS)
+	-rm -f \#* *~ *.o $(DEPDIR)/*.d $(CLEAN_FILES) check.timestamp
+	-rm -f $(OBJFILE) $(OBJNAME).syms $(OBJNAME).srec $(OBJNAME).bin
+	-rm -f kernel_cfg.timestamp $(CFG2_OUT_SRCS) cfg2_out.db
+	-rm -f offset.timestamp $(OFFSET_H)
+	-rm -f cfg1_out.syms cfg1_out.srec $(CFG1_OUT)
+	-rm -f cfg1_out.timestamp cfg1_out.c cfg1_out.db
+	-rm -rf $(TECSGENDIR)
+ifndef KERNEL_LIB
+	-rm -f libkernel.a
+endif
+	-rm -f makeoffset.s offset.h
+endif
+
 
 .PHONY: cleankernel
 cleankernel:
+ifneq ($(USE_TRUESTUDIO),true)
 	rm -f $(OFFSET_H) $(KERNEL_LIB_OBJS)
 	rm -f $(KERNEL_LIB_OBJS:%.o=$(DEPDIR)/%.d)
+else
+	-rm -f $(OFFSET_H) $(KERNEL_LIB_OBJS)
+	-rm -f $(KERNEL_LIB_OBJS:%.o=$(DEPDIR)/%.d)
+endif
+
+
+.PHONY: cleandep
+cleandep:
+	if ! [ -f Makefile.depend ]; then \
+		rm -f kernel_cfg.timestamp $(CFG2_OUT_SRCS); \
+		rm -f cfg1_out.c cfg1_out.o $(CFG1_OUT) cfg1_out.syms cfg1_out.srec; \
+		rm -f makeoffset.s offset.h; \
+	fi
+	rm -f Makefile.depend
 
 .PHONY: realclean
-realclean: clean
+ifneq ($(USE_TRUESTUDIO),true)
+realclean: cleandep clean
 	rm -f $(REALCLEAN_FILES)
+else
+realclean: cleandep clean
+	-rm -f $(REALCLEAN_FILES)
+endif
 
 #
 #  コンフィギュレータが生成したファイルのコンパイルルールの定義
@@ -442,9 +498,10 @@ ALL_CFG_ASMOBJS = $(CFG_ASMOBJS)
 $(ALL_CFG_COBJS): %.o: %.c
 	$(CC) -c -MD -MP -MF $(DEPDIR)/$*.d $(CFLAGS) $(CFG_CFLAGS) $<
 
+ifneq ($(USE_TRUESTUDIO),true)
 $(ALL_CFG_COBJS:.o=.s): %.s: %.c
 	$(CC) -S $(CFLAGS) $(CFG_CFLAGS) $<
-
+endif
 $(ALL_CFG_ASMOBJS): %.o: %.S
 	$(CC) -c -MD -MP -MF $(DEPDIR)/$*.d $(CFLAGS) $(CFG_CFLAGS) $<
 
@@ -496,12 +553,15 @@ endif
 
 #
 #  コンパイルルールの定義
-#
+#  KERNEL_AUX_COBJS,KERNEL_ALL_COBJSはasp3では定義されていない
+#KERNEL_ALL_COBJS = $(KERNEL_COBJS) $(KERNEL_AUX_COBJS)
+
 $(KERNEL_COBJS): %.o: %.c
 	$(CC) -c -MD -MP -MF $(DEPDIR)/$*.d $(CFLAGS) $(KERNEL_CFLAGS) $<
-
+ifneq ($(USE_TRUESTUDIO),true)
 $(KERNEL_COBJS:.o=.s): %.s: %.c
 	$(CC) -S $(CFLAGS) $(KERNEL_CFLAGS) $<
+endif
 
 $(KERNEL_LCOBJS): %.o:
 	$(CC) -DTOPPERS_$(*F) -o $@ -c -MD -MP -MF $(DEPDIR)/$*.d \
@@ -516,8 +576,10 @@ $(KERNEL_ASMOBJS): %.o: %.S
 $(SYSSVC_COBJS): %.o: %.c
 	$(CC) -c -MD -MP -MF $(DEPDIR)/$*.d $(CFLAGS) $(SYSSVC_CFLAGS) $<
 
+ifneq ($(USE_TRUESTUDIO),true)
 $(SYSSVC_COBJS:.o=.s): %.s: %.c
 	$(CC) -S $(CFLAGS) $(SYSSVC_CFLAGS) $<
+endif
 
 $(SYSSVC_ASMOBJS): %.o: %.S
 	$(CC) -c -MD -MP -MF $(DEPDIR)/$*.d $(CFLAGS) $(SYSSVC_CFLAGS) $<
@@ -525,17 +587,21 @@ $(SYSSVC_ASMOBJS): %.o: %.S
 $(APPL_COBJS): %.o: %.c
 	$(CC) -c -MD -MP -MF $(DEPDIR)/$*.d $(CFLAGS) $(APPL_CFLAGS) $<
 
-$(APPL_COBJS:.o=.s): %.s: %.c
+ifneq ($(USE_TRUESTUDIO),true)
+	$(APPL_COBJS:.o=.s): %.s: %.c
 	$(CC) -S $(CFLAGS) $(APPL_CFLAGS) $<
+endif
 
 $(APPL_CXXOBJS): %.o: %.cpp
-	$(CXX) -c -MD -MP -MF $(DEPDIR)/$*.d $(CFLAGS) $(APPL_CFLAGS) $<
+	$(CXX) -c -MD -MP -MF $(DEPDIR)/$*.d $(CFLAGS) $(APPL_CXXFLAGS) $<
 
+ifneq ($(USE_TRUESTUDIO),true)
 $(APPL_CXXOBJS:.o=.s): %.s: %.cpp
-	$(CXX) -S $(CFLAGS) $(APPL_CFLAGS) $<
+	$(CXX) -S $(CFLAGS) $(APPL_CXXFLAGS) $<
+endif
 
 $(APPL_ASMOBJS): %.o: %.S
-	$(CC) -c -MD -MP -MF $(DEPDIR)/$*.d $(CFLAGS) $(APPL_CFLAGS) $<
+	$(CC) -c -MD -MP -MF $(DEPDIR)/$*.d $(CFLAGS) $(APPL_CXXFLAGS) $<
 
 #
 #  デフォルトコンパイルルールを上書き
@@ -559,3 +625,46 @@ $(APPL_ASMOBJS): %.o: %.S
 %.o: %.S
 	@echo "*** Default compile rules should not be used."
 	$(CC) -c -MD -MP -MF $(DEPDIR)/$*.d $(CFLAGS) $<
+
+
+$(warning -----------------変数一覧---------------------------)
+$(warning LINK = $(LINK))
+$(warning CXX = $(CXX))
+$(warning START_OBJS = $(START_OBJS))
+$(warning END_OBJS = $(END_OBJS))
+$(warning HIDDEN_OBJS = $(HIDDEN_OBJS))
+$(warning TEXT_START_ADDRESS = $(TEXT_START_ADDRESS))
+$(warning DATA_START_ADDRESS = $(DATA_START_ADDRESS))
+$(warning dir = $(dir))
+$(warning APPLDIR = $(APPLDIR))
+$(warning INCLUDES = $(INCLUDES))
+$(warning INCLUDE_PATHS = $(INCLUDE_PATHS))
+$(warning CFLAGS = $(CFLAGS))
+$(warning COPTS = $(COPTS)) 
+$(warning CDEFS = $(CDEFS))
+$(warning LDFLAGS = $(LDFLAGS))
+$(warning OBJ_LDFLAGS = $(OBJ_LDFLAGS))
+$(warning LDSCRIPT = $(LDSCRIPT))
+$(warning CFG1_OUT_LDFLAGS = $(CFG1_OUT_LDFLAGS))
+$(warning CFG1_OUT = $(CFG1_OUT))
+$(warning LIBS = $(LIBS))
+$(warning OBJFILE = $(OBJFILE))
+$(warning APPL_CFLAGS = $(APPL_CFLAGS))
+$(warning APPL_CXXFLAGS = $(APPL_CXXFLAGS))
+$(warning APPL_COBJS = $(APPL_COBJS))
+$(warning APPL_CXXOBJS = $(APPL_CXXOBJS))
+$(warning KERNEL_CFLAGS = $(KERNEL_CFLAGS))
+$(warning CFG_CFLAGS = $(CFG_CFLAGS))
+$(warning SYSSVC_CFLAGS = $(SYSSVC_CFLAGS))
+$(warning SYSSVC_COBJS = $(SYSSVC_COBJS))
+$(warning KERNEL_FCSRCS = $(KERNEL_FCSRCS))
+$(warning KERNEL_ASMOBJS = $(KERNEL_ASMCOBJS))
+$(warning KERNEL_COBJS = $(KERNEL_COBJS))
+$(warning KERNEL_LCOBJS = $(KERNEL_LCOBJS))
+$(warning KERNEL_AUX_COBJS = $(KERNEL_AUX_COBJS))
+$(warning KERNEL_LIB_OBJS = $(KERNEL_LIB_OBJS))
+$(warning KERNEL_LIB = $(KERNEL_LIB))
+$(warning ALL_LIBS = $(ALL_LIBS))
+$(warning CXXRTS = $(CXXRTS))
+$(warning TECSDIR = $(TECSDIR))
+$(warning ------------------------------------------)
\ No newline at end of file
